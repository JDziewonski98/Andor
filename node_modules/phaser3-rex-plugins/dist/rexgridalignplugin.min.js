!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).rexgridalignplugin=e()}(this,function(){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var h=Math.sqrt(3),u=Math.sqrt(3),e=0,a=1,c=2,f=3,l=e,d=a,g=c,y=f,v={},p=e,x=a,b=c,w=f,k={},O={},_=e,W=a,X=c,Y=f,m={},z={},P=function(t,e,i){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return i;for(var n=e.split("."),r=t,o=i,s=0;s<n.length;s++){if(!r.hasOwnProperty(n[s])){o=i;break}o=r[n[s]],r=r[n[s]]}return o}return i},T=e,M=a,H=c,S=f,j=function(){function e(t){i(this,e),this.resetFromJSON(t)}return t(e,[{key:"resetFromJSON",value:function(t){if(this.setType(P(t,"staggeraxis",1),P(t,"staggerindex",1)),this.setDirectionMode(),this.setOriginPosition(P(t,"x",0),P(t,"y",0)),this.size=P(t,"size",void 0),void 0!==this.size){var e={size:this.size,type:this.staggeraxis},i=0===(o=e).type?2*o.size:h*o.size,n=0===(r=e).type?u*r.size:2*r.size;this.setCellSize(i,n)}else this.setCellSize(P(t,"cellWidth",0),P(t,"cellHeight",0));var r,o}},{key:"setType",value:function(t,e){return"string"==typeof t&&(t=E[t]),"string"==typeof e&&(e=F[e]),this.staggeraxis=t,this.staggerindex=e,this.mode=0===t?0===e?S:H:0===e?M:T,this}},{key:"setDirectionMode",value:function(){return this.directions=6,this}},{key:"setOriginPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setCellSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._halfWidth=t/2}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._halfHeight=t/2}},{key:"cellWidth",get:function(){return this.width},set:function(t){this.width=t}},{key:"cellHeight",get:function(){return this.height}},{key:"cellHieght",set:function(t){this.height=t}}]),e}(),C={getWorldXY:function(t,e,i){void 0===i?i={}:!0===i&&(i=v);var n=t*this.width,r=e*this.height;switch(this.mode){case l:1&e&&(n+=this._halfWidth),r*=.75;break;case d:1&e&&(n-=this._halfWidth),r*=.75;break;case g:n*=.75,1&t&&(r+=this._halfHeight);break;case y:n*=.75,1&t&&(r-=this._halfHeight)}return n+=this.x,r+=this.y,i.x=n,i.y=r,i},getWorldX:function(t,e){return this.getWorldXY(t,e,!0).x},getWorldY:function(t,e){return this.getWorldXY(t,e,!0).y},getTileXY:function(t,e,i){var n,r;switch(void 0===i?i={}:!0===i&&(i=z),t-=this.x,e-=this.y,this.mode){case _:case W:r=e*(4/3)/this.height,n=t/this.width-2/3*(e/this.height);break;case X:case Y:r=e/this.height-2/3*(t/this.width),n=t*(4/3)/this.width}var o,s,h,u=(o=n,s=r,void 0===(h=m)?h={}:!0===h&&(h=k),h.x=o,h.y=-o-s,h.z=s,h);return function(t,e,i,n){"number"!=typeof t&&(t=(n=t).x,e=n.y,i=n.z),void 0===n?n={}:!0===n&&(n=k);var r=Math.round(t),o=Math.round(e),s=Math.round(i),h=Math.abs(r-t),u=Math.abs(o-e),a=Math.abs(s-i);u<h&&a<h?r=-o-s:a<u?o=-r-s:s=-r-o,n.x=r,n.y=o,n.z=s}(u),function(t,e,i,n){switch(void 0===n?n={}:!0===n&&(n=O),t){case p:n.x=e+(i-(1&i))/2,n.y=i;break;case x:n.x=e+(i+(1&i))/2,n.y=i;break;case b:n.x=e,n.y=i+(e-(1&e))/2;break;case w:n.x=e,n.y=i+(e+(1&e))/2}}(this.mode,u.x,(u.y,u.z),i),i},getTileX:function(t,e){return this.getTileXY(t,e,!0).x},getTileY:function(t,e){return this.getTileXY(t,e,!0).y}};Object.assign(j.prototype,C);function D(){}var E={y:0,x:1},F={even:0,odd:1},N=new Phaser.GameObjects.Zone({sys:{queueDepthSort:D,events:{once:D}}},0,0,1,1);N.setOrigin(0);function q(t){return void 0!==t.displayWidth?t.displayWidth:t.width}function J(t){return void 0!==t.displayHeight?t.displayHeight:t.height}function G(t){var e=J(t);return t.y+e-e*t.originY}function R(t){var e=q(t);return t.x-e*t.originX+.5*e}function A(t,e){var i=J(t);return t.y=e-i+i*t.originY,t}function U(t,e){var i=q(t),n=i*t.originX;return t.x=e+n-.5*i,t}function V(t){var e=q(t);return t.x-e*t.originX}function B(t,e){var i=q(t);return t.x=e+i*t.originX,t}function Z(t){var e=q(t);return t.x+e-e*t.originX}function I(t,e){var i=q(t);return t.x=e-i+i*t.originX,t}function K(t,e){var i=J(t),n=i*t.originY;return t.y=e+n-.5*i,t}function L(t){var e=J(t);return t.y-e*t.originY+.5*e}function Q(t){var e=J(t);return t.y-e*t.originY}function $(t,e){var i=J(t);return t.y=e+i*t.originY,t}var tt=0,et=1,it=2,nt=4,rt=6,ot=8,st=10,ht=12,ut=[];ut[11]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),U(t,R(e)+i),A(t,G(e)+n),t},ut[st]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),B(t,V(e)-i),A(t,G(e)+n),t},ut[ht]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),I(t,Z(e)+i),A(t,G(e)+n),t},ut[rt]=function(t,e,i,n){var r,o,s;return void 0===i&&(i=0),void 0===n&&(n=0),r=t,o=R(e)+i,s=L(e)+n,U(r,o),K(r,s),t},ut[nt]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),B(t,V(e)-i),K(t,L(e)+n),t},ut[ot]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),I(t,Z(e)+i),K(t,L(e)+n),t},ut[et]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),U(t,R(e)+i),$(t,Q(e)-n),t},ut[tt]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),B(t,V(e)-i),$(t,Q(e)-n),t},ut[it]=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),I(t,Z(e)+i),$(t,Q(e)-n),t};function at(t,e,i,n,r){return ut[i](t,e,n,r)}var ct=Phaser.Utils.Objects.GetFastValue,ft=new j,lt={},dt={},gt=function(){function e(t){i(this,e),this.resetFromJSON(t)}return t(e,[{key:"resetFromJSON",value:function(t){this.setType(P(t,"type",0)),this.setDirectionMode(P(t,"dir",4)),this.setOriginPosition(P(t,"x",0),P(t,"y",0)),this.setCellSize(P(t,"cellWidth",0),P(t,"cellHeight",0))}},{key:"setType",value:function(t){return"string"==typeof t&&(t=vt[t]),this.mode=t,this}},{key:"setDirectionMode",value:function(t){return"string"==typeof t&&(t=pt[t]),this.directions=t,this}},{key:"setOriginPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setCellSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._halfWidth=t/2}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._halfHeight=t/2}},{key:"cellWidth",get:function(){return this.width},set:function(t){this.width=t}},{key:"cellHeight",get:function(){return this.height}},{key:"cellHieght",set:function(t){this.height=t}}]),e}(),yt={getWorldXY:function(t,e,i){var n,r;switch(void 0===i?i={}:!0===i&&(i=lt),this.mode){case 0:n=t*this.width,r=e*this.height;break;case 1:n=(t-e)*this._halfWidth,r=(t+e)*this._halfHeight}return n+=this.x,r+=this.y,i.x=n,i.y=r,i},getWorldX:function(t,e){return this.getWorldXY(t,e,!0).x},getWorldY:function(t,e){return this.getWorldXY(t,e,!0).y},getTileXY:function(t,e,i){void 0===i?i={}:!0===i&&(i=dt),t-=this.x,e-=this.y;var n=t/this.width,r=e/this.height;switch(this.mode){case 0:i.x=Math.round(n),i.y=Math.round(r);break;case 1:i.x=Math.round(+n+r),i.y=Math.round(r-n)}return i},getTileX:function(t,e){return this.getTileXY(t,e,!0).x},getTileY:function(t,e){return this.getTileXY(t,e,!0).y}};Object.assign(gt.prototype,yt);var vt={orthogonal:0,isometric:1,staggered:2},pt={"4dir":4,"8dir":8},xt=Phaser.Utils.Objects.GetFastValue,bt=new gt;return function(){function e(t){return i(this,e),s(this,r(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(e,Phaser.Plugins.BasePlugin),t(e,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"hexagon",value:function(t,e){return function(t,e){void 0===e&&(e={});var i=ct(e,"width",-1),n=ct(e,"height",-1),r=ct(e,"cellWidth",1),o=ct(e,"cellHeight",r),s=ct(e,"staggeraxis",1),h=ct(e,"staggerindex",1),u=ct(e,"position",Phaser.Display.Align.CENTER),a=ct(e,"x",0),c=ct(e,"y",0);ft.setOriginPosition(a,c).setCellSize(r,o).setType(s,h),N.setSize(r,o);for(var f=n-1,l=i-1,d=0,g=0,y=0,v=t.length;y<v;y++)if(ft.getWorldXY(g,d,N),at(t[y],N,u),-1===i)d++;else if(-1===n)g++;else if(g===l){if(d===f)break;g=0,d++}else g++;return t}(t,e)}},{key:"quad",value:function(t,e){return function(t,e){void 0===e&&(e={});var i=xt(e,"width",-1),n=xt(e,"height",-1),r=xt(e,"cellWidth",1),o=xt(e,"cellHeight",r),s=xt(e,"type",0),h=xt(e,"position",Phaser.Display.Align.CENTER),u=xt(e,"x",0),a=xt(e,"y",0);bt.setOriginPosition(u,a).setCellSize(r,o).setType(s),N.setSize(r,o);for(var c=n-1,f=i-1,l=0,d=0,g=0,y=t.length;g<y;g++)if(bt.getWorldXY(d,l,N),at(t[g],N,h),-1===i)l++;else if(-1===n)d++;else if(d===f){if(l===c)break;d=0,l++}else d++;return t}(t,e)}}]),e}()});
